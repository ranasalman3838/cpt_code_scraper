import requests
from bs4 import BeautifulSoup
import csv



urls = ['https://www.aapc.com/codes/cpt-codes/00100', 'https://www.aapc.com/codes/cpt-codes/00102', 'https://www.aapc.com/codes/cpt-codes/00103', 'https://www.aapc.com/codes/cpt-codes/00104', 'https://www.aapc.com/codes/cpt-codes/00120', 'https://www.aapc.com/codes/cpt-codes/00124', 'https://www.aapc.com/codes/cpt-codes/00126', 'https://www.aapc.com/codes/cpt-codes/00140', 'https://www.aapc.com/codes/cpt-codes/00142', 'https://www.aapc.com/codes/cpt-codes/00144', 'https://www.aapc.com/codes/cpt-codes/00145', 'https://www.aapc.com/codes/cpt-codes/00147', 'https://www.aapc.com/codes/cpt-codes/00148', 'https://www.aapc.com/codes/cpt-codes/00160', 'https://www.aapc.com/codes/cpt-codes/00162', 'https://www.aapc.com/codes/cpt-codes/00164', 'https://www.aapc.com/codes/cpt-codes/00170', 'https://www.aapc.com/codes/cpt-codes/00172', 'https://www.aapc.com/codes/cpt-codes/00174', 'https://www.aapc.com/codes/cpt-codes/00176', 'https://www.aapc.com/codes/cpt-codes/00190', 'https://www.aapc.com/codes/cpt-codes/00192', 'https://www.aapc.com/codes/cpt-codes/00210', 'https://www.aapc.com/codes/cpt-codes/00211', 'https://www.aapc.com/codes/cpt-codes/00212', 'https://www.aapc.com/codes/cpt-codes/00214', 'https://www.aapc.com/codes/cpt-codes/00215', 'https://www.aapc.com/codes/cpt-codes/00216', 'https://www.aapc.com/codes/cpt-codes/00218', 'https://www.aapc.com/codes/cpt-codes/00220', 'https://www.aapc.com/codes/cpt-codes/00222', 'https://www.aapc.com/codes/cpt-codes/00300', 'https://www.aapc.com/codes/cpt-codes/00320', 'https://www.aapc.com/codes/cpt-codes/00322', 'https://www.aapc.com/codes/cpt-codes/00326', 'https://www.aapc.com/codes/cpt-codes/00350', 'https://www.aapc.com/codes/cpt-codes/00352', 'https://www.aapc.com/codes/cpt-codes/00400', 'https://www.aapc.com/codes/cpt-codes/00402', 'https://www.aapc.com/codes/cpt-codes/00404', 'https://www.aapc.com/codes/cpt-codes/00406', 'https://www.aapc.com/codes/cpt-codes/00410', 'https://www.aapc.com/codes/cpt-codes/00450', 'https://www.aapc.com/codes/cpt-codes/00454', 'https://www.aapc.com/codes/cpt-codes/00470', 'https://www.aapc.com/codes/cpt-codes/00472', 'https://www.aapc.com/codes/cpt-codes/00474', 'https://www.aapc.com/codes/cpt-codes/00500', 'https://www.aapc.com/codes/cpt-codes/00520', 'https://www.aapc.com/codes/cpt-codes/00522', 'https://www.aapc.com/codes/cpt-codes/00524', 'https://www.aapc.com/codes/cpt-codes/00528', 'https://www.aapc.com/codes/cpt-codes/00529', 'https://www.aapc.com/codes/cpt-codes/00530', 'https://www.aapc.com/codes/cpt-codes/00532', 'https://www.aapc.com/codes/cpt-codes/00534', 'https://www.aapc.com/codes/cpt-codes/00537', 'https://www.aapc.com/codes/cpt-codes/00539', 'https://www.aapc.com/codes/cpt-codes/00540', 'https://www.aapc.com/codes/cpt-codes/00541', 'https://www.aapc.com/codes/cpt-codes/00542', 'https://www.aapc.com/codes/cpt-codes/00546', 'https://www.aapc.com/codes/cpt-codes/00548', 'https://www.aapc.com/codes/cpt-codes/00550', 'https://www.aapc.com/codes/cpt-codes/00560', 'https://www.aapc.com/codes/cpt-codes/00561', 'https://www.aapc.com/codes/cpt-codes/00562', 'https://www.aapc.com/codes/cpt-codes/00563', 'https://www.aapc.com/codes/cpt-codes/00566', 'https://www.aapc.com/codes/cpt-codes/00567', 'https://www.aapc.com/codes/cpt-codes/00580', 'https://www.aapc.com/codes/cpt-codes/00600', 'https://www.aapc.com/codes/cpt-codes/00604', 'https://www.aapc.com/codes/cpt-codes/00620', 'https://www.aapc.com/codes/cpt-codes/00625', 'https://www.aapc.com/codes/cpt-codes/00626', 'https://www.aapc.com/codes/cpt-codes/00630', 'https://www.aapc.com/codes/cpt-codes/00632', 'https://www.aapc.com/codes/cpt-codes/00635', 'https://www.aapc.com/codes/cpt-codes/00640', 'https://www.aapc.com/codes/cpt-codes/00670', 'https://www.aapc.com/codes/cpt-codes/00700', 'https://www.aapc.com/codes/cpt-codes/00702', 'https://www.aapc.com/codes/cpt-codes/00730', 'https://www.aapc.com/codes/cpt-codes/00731', 'https://www.aapc.com/codes/cpt-codes/00732', 'https://www.aapc.com/codes/cpt-codes/00750', 'https://www.aapc.com/codes/cpt-codes/00752', 'https://www.aapc.com/codes/cpt-codes/00754', 'https://www.aapc.com/codes/cpt-codes/00756', 'https://www.aapc.com/codes/cpt-codes/00770', 'https://www.aapc.com/codes/cpt-codes/00790', 'https://www.aapc.com/codes/cpt-codes/00792', 'https://www.aapc.com/codes/cpt-codes/00794', 'https://www.aapc.com/codes/cpt-codes/00796', 'https://www.aapc.com/codes/cpt-codes/00797', 'https://www.aapc.com/codes/cpt-codes/00800', 'https://www.aapc.com/codes/cpt-codes/00802', 'https://www.aapc.com/codes/cpt-codes/00811', 'https://www.aapc.com/codes/cpt-codes/00812', 'https://www.aapc.com/codes/cpt-codes/00813', 'https://www.aapc.com/codes/cpt-codes/00820', 'https://www.aapc.com/codes/cpt-codes/00830', 'https://www.aapc.com/codes/cpt-codes/00832', 'https://www.aapc.com/codes/cpt-codes/00834', 'https://www.aapc.com/codes/cpt-codes/00836', 'https://www.aapc.com/codes/cpt-codes/00840', 'https://www.aapc.com/codes/cpt-codes/00842', 'https://www.aapc.com/codes/cpt-codes/00844', 'https://www.aapc.com/codes/cpt-codes/00846', 'https://www.aapc.com/codes/cpt-codes/00848', 'https://www.aapc.com/codes/cpt-codes/00851', 'https://www.aapc.com/codes/cpt-codes/00860', 'https://www.aapc.com/codes/cpt-codes/00862', 'https://www.aapc.com/codes/cpt-codes/00864', 'https://www.aapc.com/codes/cpt-codes/00865', 'https://www.aapc.com/codes/cpt-codes/00866', 'https://www.aapc.com/codes/cpt-codes/00868', 'https://www.aapc.com/codes/cpt-codes/00870', 'https://www.aapc.com/codes/cpt-codes/00872', 'https://www.aapc.com/codes/cpt-codes/00873', 'https://www.aapc.com/codes/cpt-codes/00880', 'https://www.aapc.com/codes/cpt-codes/00882', 'https://www.aapc.com/codes/cpt-codes/00902', 'https://www.aapc.com/codes/cpt-codes/00904', 'https://www.aapc.com/codes/cpt-codes/00906', 'https://www.aapc.com/codes/cpt-codes/00908', 'https://www.aapc.com/codes/cpt-codes/00910', 'https://www.aapc.com/codes/cpt-codes/00912', 'https://www.aapc.com/codes/cpt-codes/00914', 'https://www.aapc.com/codes/cpt-codes/00916', 'https://www.aapc.com/codes/cpt-codes/00918', 'https://www.aapc.com/codes/cpt-codes/00920', 'https://www.aapc.com/codes/cpt-codes/00921', 'https://www.aapc.com/codes/cpt-codes/00922', 'https://www.aapc.com/codes/cpt-codes/00924', 'https://www.aapc.com/codes/cpt-codes/00926', 'https://www.aapc.com/codes/cpt-codes/00928', 'https://www.aapc.com/codes/cpt-codes/00930', 'https://www.aapc.com/codes/cpt-codes/00932', 'https://www.aapc.com/codes/cpt-codes/00934', 'https://www.aapc.com/codes/cpt-codes/00936', 'https://www.aapc.com/codes/cpt-codes/00938', 'https://www.aapc.com/codes/cpt-codes/00940', 'https://www.aapc.com/codes/cpt-codes/00942', 'https://www.aapc.com/codes/cpt-codes/00944', 'https://www.aapc.com/codes/cpt-codes/00948', 'https://www.aapc.com/codes/cpt-codes/00950', 'https://www.aapc.com/codes/cpt-codes/00952', 'https://www.aapc.com/codes/cpt-codes/01112', 'https://www.aapc.com/codes/cpt-codes/01120', 'https://www.aapc.com/codes/cpt-codes/01130', 'https://www.aapc.com/codes/cpt-codes/01140', 'https://www.aapc.com/codes/cpt-codes/01150', 'https://www.aapc.com/codes/cpt-codes/01160', 'https://www.aapc.com/codes/cpt-codes/01170', 'https://www.aapc.com/codes/cpt-codes/01173', 'https://www.aapc.com/codes/cpt-codes/01200', 'https://www.aapc.com/codes/cpt-codes/01202', 'https://www.aapc.com/codes/cpt-codes/01210', 'https://www.aapc.com/codes/cpt-codes/01212', 'https://www.aapc.com/codes/cpt-codes/01214', 'https://www.aapc.com/codes/cpt-codes/01215', 'https://www.aapc.com/codes/cpt-codes/01220', 'https://www.aapc.com/codes/cpt-codes/01230', 'https://www.aapc.com/codes/cpt-codes/01232', 'https://www.aapc.com/codes/cpt-codes/01234', 'https://www.aapc.com/codes/cpt-codes/01250', 'https://www.aapc.com/codes/cpt-codes/01260', 'https://www.aapc.com/codes/cpt-codes/01270', 'https://www.aapc.com/codes/cpt-codes/01272', 'https://www.aapc.com/codes/cpt-codes/01274', 'https://www.aapc.com/codes/cpt-codes/01320', 'https://www.aapc.com/codes/cpt-codes/01340', 'https://www.aapc.com/codes/cpt-codes/01360', 'https://www.aapc.com/codes/cpt-codes/01380', 'https://www.aapc.com/codes/cpt-codes/01382', 'https://www.aapc.com/codes/cpt-codes/01390', 'https://www.aapc.com/codes/cpt-codes/01392', 'https://www.aapc.com/codes/cpt-codes/01400', 'https://www.aapc.com/codes/cpt-codes/01402', 'https://www.aapc.com/codes/cpt-codes/01404', 'https://www.aapc.com/codes/cpt-codes/01420', 'https://www.aapc.com/codes/cpt-codes/01430', 'https://www.aapc.com/codes/cpt-codes/01432', 'https://www.aapc.com/codes/cpt-codes/01440', 'https://www.aapc.com/codes/cpt-codes/01442', 'https://www.aapc.com/codes/cpt-codes/01444', 'https://www.aapc.com/codes/cpt-codes/01462', 'https://www.aapc.com/codes/cpt-codes/01464', 'https://www.aapc.com/codes/cpt-codes/01470', 'https://www.aapc.com/codes/cpt-codes/01472', 'https://www.aapc.com/codes/cpt-codes/01474', 'https://www.aapc.com/codes/cpt-codes/01480', 'https://www.aapc.com/codes/cpt-codes/01482', 'https://www.aapc.com/codes/cpt-codes/01484', 'https://www.aapc.com/codes/cpt-codes/01486', 'https://www.aapc.com/codes/cpt-codes/01490', 'https://www.aapc.com/codes/cpt-codes/01500', 'https://www.aapc.com/codes/cpt-codes/01502', 'https://www.aapc.com/codes/cpt-codes/01520', 'https://www.aapc.com/codes/cpt-codes/01522', 'https://www.aapc.com/codes/cpt-codes/01610', 'https://www.aapc.com/codes/cpt-codes/01620', 'https://www.aapc.com/codes/cpt-codes/01622', 'https://www.aapc.com/codes/cpt-codes/01630', 'https://www.aapc.com/codes/cpt-codes/01634', 'https://www.aapc.com/codes/cpt-codes/01636', 'https://www.aapc.com/codes/cpt-codes/01638', 'https://www.aapc.com/codes/cpt-codes/01650', 'https://www.aapc.com/codes/cpt-codes/01652', 'https://www.aapc.com/codes/cpt-codes/01654', 'https://www.aapc.com/codes/cpt-codes/01656', 'https://www.aapc.com/codes/cpt-codes/01670', 'https://www.aapc.com/codes/cpt-codes/01680', 'https://www.aapc.com/codes/cpt-codes/01710', 'https://www.aapc.com/codes/cpt-codes/01712', 'https://www.aapc.com/codes/cpt-codes/01714', 'https://www.aapc.com/codes/cpt-codes/01716', 'https://www.aapc.com/codes/cpt-codes/01730', 'https://www.aapc.com/codes/cpt-codes/01732', 'https://www.aapc.com/codes/cpt-codes/01740', 'https://www.aapc.com/codes/cpt-codes/01742', 'https://www.aapc.com/codes/cpt-codes/01744', 'https://www.aapc.com/codes/cpt-codes/01756', 'https://www.aapc.com/codes/cpt-codes/01758', 'https://www.aapc.com/codes/cpt-codes/01760', 'https://www.aapc.com/codes/cpt-codes/01770', 'https://www.aapc.com/codes/cpt-codes/01772', 'https://www.aapc.com/codes/cpt-codes/01780', 'https://www.aapc.com/codes/cpt-codes/01782', 'https://www.aapc.com/codes/cpt-codes/01810', 'https://www.aapc.com/codes/cpt-codes/01820', 'https://www.aapc.com/codes/cpt-codes/01829', 'https://www.aapc.com/codes/cpt-codes/01830', 'https://www.aapc.com/codes/cpt-codes/01832', 'https://www.aapc.com/codes/cpt-codes/01840', 'https://www.aapc.com/codes/cpt-codes/01842', 'https://www.aapc.com/codes/cpt-codes/01844', 'https://www.aapc.com/codes/cpt-codes/01850', 'https://www.aapc.com/codes/cpt-codes/01852', 'https://www.aapc.com/codes/cpt-codes/01860', 'https://www.aapc.com/codes/cpt-codes/01916', 'https://www.aapc.com/codes/cpt-codes/01920', 'https://www.aapc.com/codes/cpt-codes/01922', 'https://www.aapc.com/codes/cpt-codes/01924', 'https://www.aapc.com/codes/cpt-codes/01925', 'https://www.aapc.com/codes/cpt-codes/01926', 'https://www.aapc.com/codes/cpt-codes/01930', 'https://www.aapc.com/codes/cpt-codes/01931', 'https://www.aapc.com/codes/cpt-codes/01932', 'https://www.aapc.com/codes/cpt-codes/01933', 'https://www.aapc.com/codes/cpt-codes/01937', 'https://www.aapc.com/codes/cpt-codes/01938', 'https://www.aapc.com/codes/cpt-codes/01939', 'https://www.aapc.com/codes/cpt-codes/01940', 'https://www.aapc.com/codes/cpt-codes/01941', 'https://www.aapc.com/codes/cpt-codes/01942', 'https://www.aapc.com/codes/cpt-codes/01951', 'https://www.aapc.com/codes/cpt-codes/01952', 'https://www.aapc.com/codes/cpt-codes/01953', 'https://www.aapc.com/codes/cpt-codes/01958', 'https://www.aapc.com/codes/cpt-codes/01960', 'https://www.aapc.com/codes/cpt-codes/01961', 'https://www.aapc.com/codes/cpt-codes/01962', 'https://www.aapc.com/codes/cpt-codes/01963', 'https://www.aapc.com/codes/cpt-codes/01965', 'https://www.aapc.com/codes/cpt-codes/01966', 'https://www.aapc.com/codes/cpt-codes/01967', 'https://www.aapc.com/codes/cpt-codes/01968', 'https://www.aapc.com/codes/cpt-codes/01969', 'https://www.aapc.com/codes/cpt-codes/01990', 'https://www.aapc.com/codes/cpt-codes/01991', 'https://www.aapc.com/codes/cpt-codes/01992', 'https://www.aapc.com/codes/cpt-codes/01996', 'https://www.aapc.com/codes/cpt-codes/01999']

# urls = ['https://www.aapc.com/codes/cpt-codes/00100', 'https://www.aapc.com/codes/cpt-codes/00102', 'https://www.aapc.com/codes/cpt-codes/00103']
def fetch_request(url):
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36'
    }

    response = requests.get(url, headers=headers)

    # Check if the response is successful
    if response.status_code != 200:
        # print(f"Failed to retrieve page {page_no} for court {court}")
        return "failed to retrieve"

    # Step 3: Parse the HTML content using BeautifulSoup
    soup = BeautifulSoup(response.content, 'html.parser')
    return soup

def extract_data(soup, url):
    summary = soup.find('div', id='cpt_layterms').find('p').get_text(strip=True)
    sub_category = soup.find('h1').get_text(strip=True)
    main_category = 'Anesthesia'
    code = url.split('/')[-1]

    data = {
        'category': main_category,
        'sub_category': sub_category,
        'code': code,
        'summary': summary
    }

    return data

def generate_csv(data):
    # Define the CSV file name
    csv_file_name = 'anesthesia_data.csv'

    # Writing to the CSV file
    with open(csv_file_name, mode='w', newline='', encoding='utf-8') as file:
        writer = csv.DictWriter(file, fieldnames=['category', 'sub_category', 'code', 'summary'])
        writer.writeheader()  # Write the header row
        writer.writerows(data)  # Write the data rows

def main(urls):
    data_list = []
    for url in urls:
        soup = fetch_request(url)
        data = extract_data(soup, url)
        data_list.append(data)

    generate_csv(data_list)


main(urls)



